name: Secrets and Environment Variables

on:
  workflow_dispatch:

jobs:
  top-env-variables:
    runs-on: ubuntu-latest
    environment: Production

    steps:
      - name: Read a Variable
        run: |
          echo "${{ vars.API_URL }}"
          echo "${{ vars.PROD_VAR }}"
          echo "${{ vars.API_URL_URL }}"

      - name: Read a Secret
        run: |
          echo "My prod_secret is ${{ secrets.PRODUCTION_SECRET }}"
          echo "My global_secret is ${{ secrets.MY_SECRET }}"

      - name: Render vars as JSON and save to file
        run: |
          echo '${{ toJSON(vars) }}' > vars.json

      - name: Create .env file from vars.json
        run: |
          echo "Creating .env file..."
          jq -r 'to_entries | .[] | "\(.key)=\(.value)"' vars.json > .env

      - name: Display .env file contents
        run: |
          cat .env
